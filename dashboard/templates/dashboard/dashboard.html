{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Monitoring{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}">
<!-- Font Awesome -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  integrity="sha512-8N4+aWnms0ZqU3SbdVQ2pEoPEt0kXUS6T2qBlWWdUBxYfFdFaYxC6mGmXK7sCVG7mAJGcK1wz5P8lYz8v3Bvw=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
<style>
    .chart-title, .sensor-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: #2c3e50;
    }

    .sensor-label i {
        margin-right: 6px;
    }

    .sensor-label i:hover {
        transform: scale(1.2);
        transition: 0.2s ease;
    }

    .alert i {
        margin-right: 6px;
    }
</style>
{% endblock %}

{% block content %}
<section class="dashboard-container">
    <h1>Dashboard Monitoring</h1>

    <p>Selamat datang kembali, Ahmad! Berikut ringkasan kondisi tanaman Anda hari ini.</p>

    <!-- STAT CARDS -->
    <div class="stats">
        <div class="card sehat">
            <h2>100</h2>
            <p>Tanaman Sehat</p>
        </div>
        <div class="card sakit">
            <h2>127</h2>
            <p>Tanaman Sakit</p>
        </div>
        <div class="card risiko">
            <h2>31%</h2>
            <p>Risiko Serangan Hama</p>
        </div>
        <div class="card kelembapan">
            <h2>75%</h2>
            <p>Kelembapan</p>
        </div>
    </div>

    <!-- ALERT -->
    <div class="alert">
        <i class="fa-solid fa-triangle-exclamation" style="color: #FFD43B;"></i>
        Kondisi kelembapan tanah rendah terdeteksi pada area. Segera lakukan penyiraman untuk mencegah stress pada tanaman.
    </div>

    <!-- CHART -->
    <div class="chart-box">
        <h3 class="chart-title">
            <i class="fa-solid fa-chart-simple" style="color:#2c3e50;"></i> Data Sensor Real-Time
        </h3>
        <canvas id="sensorChart"></canvas>
    </div>

    <!-- SENSOR DATA -->
    <div class="sensor-box">
        <h4 class="sensor-title">
            <i class="fa-solid fa-calendar-day" style="color:#2c3e50;"></i> Data Sensor Terbaru
        </h4>
        <p style="margin-bottom: 15px; color: #666;">Update terakhir: 14 Okt 2025, 21:30 WIB</p>
        <div class="sensor-stats">
            <div class="sensor-item">
                <span class="sensor-label">
                    <i class="fa-solid fa-temperature-three-quarters" style="color:#e74c3c;"></i> Suhu:
                </span>
                <span class="sensor-value">28°C</span>
            </div>
            <div class="sensor-item">
                <span class="sensor-label">
                    <i class="fa-solid fa-droplet" style="color:#3498db;"></i> Kelembapan:
                </span>
                <span class="sensor-value">75%</span>
            </div>
        </div>
        <button class="btn-warning">
            <i class="fa-solid fa-triangle-exclamation"></i> Lihat Peringatan
        </button>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
const ctx = document.getElementById('sensorChart').getContext('2d');

const sensorChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
        datasets: [
            {
                label: 'Suhu (°C)',
                data: [24, 23, 26, 29, 31, 28, 25],
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            },
            {
                label: 'Kelembapan (%)',
                data: [80, 82, 78, 75, 72, 75, 78],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            },
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 2.5,
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: {
                        size: 13,
                        family: "'Poppins', sans-serif",
                        weight: '500'
                    }
                }
            },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 12,
                titleFont: {
                    size: 14,
                    family: "'Poppins', sans-serif",
                    weight: '600'
                },
                bodyFont: {
                    size: 13,
                    family: "'Poppins', sans-serif"
                },
                borderColor: 'rgba(255, 255, 255, 0.2)',
                borderWidth: 1
            }
        },
        scales: {
            y: {
                beginAtZero: false,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)',
                    drawBorder: false
                },
                ticks: {
                    font: {
                        family: "'Poppins', sans-serif",
                        size: 12
                    },
                    padding: 10
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    font: {
                        family: "'Poppins', sans-serif",
                        size: 12
                    },
                    padding: 10
                }
            }
        },
        interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
        }
    }
});

window.addEventListener('load', function() {
    sensorChart.update('active');
});
</script>
{% endblock %}
