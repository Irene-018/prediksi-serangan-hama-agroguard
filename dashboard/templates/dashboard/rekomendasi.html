{% extends 'base.html' %}
{% load static %}

{% block title %}Rekomendasi Treatment - AgroGuard{% endblock %}

{% block extra_css %}
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Fonts dan CSS utama -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Roboto:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'dashboard/css/recommendation.css' %}">
{% endblock %}

{% block content %}
<section class="recommendation-section">
  <h1> Rekomendasi Treatment</h1>
  <p class="subtitle">
    {% if hasil %}
      Panduan penanganan untuk hasil deteksi terbaru tanaman Anda.
    {% else %}
      Belum ada hasil deteksi. Lakukan deteksi terlebih dahulu untuk mendapatkan rekomendasi.
    {% endif %}
  </p>

  {% if not hasil %}
    <div class="info-section" style="margin-top: 20px;">
      <p>
        Tidak ditemukan data deteksi pada akun Anda. Silakan unggah foto daun di menu
        <strong>Deteksi</strong> untuk mendapatkan rekomendasi treatment yang spesifik.
      </p>
    </div>
  {% else %}

  <!-- === Hasil Deteksi === -->
  <div class="hama-summary">
    <div class="hama-photo">
      {% if hasil.citra.path_file %}
        <img src="{{ hasil.citra.path_file.url }}" alt="Hasil Deteksi">
      {% else %}
        <img src="{% static 'recommendation/images/sample-leaf.png' %}" alt="Hama">
      {% endif %}
    </div>
    <div class="hama-info">
      <h2>{{ hasil.jenis_hama.nama }}</h2>
      <p class="latin">
        <i class="fa-solid fa-leaf"></i>
        {{ hasil.jenis_hama.nama_latin|default:"Nama latin belum diisi" }}
      </p>
      <div class="meta">
        <span>
          <i class="fa-solid fa-calendar-days"></i>
          Waktu :
          {{ hasil.waktu_deteksi|date:"d M Y H:i" }}
        </span>
        <span>
          <i class="fa-solid fa-triangle-exclamation"></i>
          Confidence :
          {{ hasil.confidence_score }}%
        </span>
      </div>
    </div>
  </div>

  <!-- === Dua Kolom === -->
  <div class="recommendation-grid">
    <!-- Kolom Kiri: Pestisida -->
    <div class="card">
      <h3> Pestisida Rekomendasi</h3>
      <div class="card-content">
        {% if hasil.jenis_hama.cara_penanganan %}
          <p>{{ hasil.jenis_hama.cara_penanganan|linebreaks }}</p>
        {% else %}
          <p>Belum ada data penanganan khusus untuk hama ini. Silakan konsultasikan dengan penyuluh pertanian.</p>
        {% endif %}
      </div>
    </div>

    <!-- Kolom Kanan: Dosis -->
    <div class="card">
      <h3>Dosis dan Cara Aplikasi</h3>
      <div class="card-content">
        <div class="dosage-item">
          <strong>Tingkat Serangan :</strong>
          {% if hasil.tingkat_serangan == 'ringan' %}
            Ringan
          {% elif hasil.tingkat_serangan == 'sedang' %}
            Sedang
          {% elif hasil.tingkat_serangan == 'berat' %}
            Berat
          {% else %}
            Tidak diketahui
          {% endif %}
        </div>
        <div class="dosage-item">
          <strong>Rekomendasi Sistem :</strong>
          {{ hasil.rekomendasi }}
        </div>
      </div>
    </div>
  </div>

  <!-- === Penjelasan Tambahan === -->
  <div class="info-section">
    <h4>Gejala Serangan:</h4>
    <p>
      {{ hasil.jenis_hama.gejala|default:"Belum ada data gejala yang tersimpan untuk hama ini." }}
    </p>

    <h4>Pencegahan Umum:</h4>
    <p>
      {{ hasil.jenis_hama.cara_pencegahan|default:"Belum ada data pencegahan yang tersimpan untuk hama ini." }}
    </p>

    <div class="btn-group">
      <a href="#" class="btn btn-download">
        <i class="fa-solid fa-file-arrow-down"></i> Download Panduan Lengkap (PDF)
      </a>
      <a href="#" class="btn btn-tutorial">
        <i class="fa-brands fa-youtube"></i> Tutorial YouTube
      </a>
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
